@echo off
:: 设置编码为 UTF-8，防止中文乱码
chcp 65001 >nul
title Hexo 博客一键自动部署与备份

echo =======================================================
echo            Hexo 博客智能部署助手 v3.1 (修正版)
echo =======================================================
echo.

:: [关键] 切换到博客根目录
cd /d D:\hexo

:: ---------------------------------------------------------
:: 第 1 步：智能更新时间戳
:: ---------------------------------------------------------
echo [1/4] 正在调用 Python 检查文章变动...
python update.py

:: ---------------------------------------------------------
:: 第 2 步：生成静态网页
:: ---------------------------------------------------------
echo.
echo [2/4] 正在清理缓存...
call hexo clean

echo.
echo [2.5/4] 正在生成静态页面...
:: 【修正】使用全称 generate 而不是 g，防止脚本识别错误
call hexo generate

:: ---------------------------------------------------------
:: 第 3 步：部署到 GitHub Pages (给读者看)
:: ---------------------------------------------------------
echo.
echo [3/4] 正在部署网页到 GitHub Pages (master 分支)...
:: 【修正】使用全称 deploy 而不是 d
call hexo deploy

:: ---------------------------------------------------------
:: 第 4 步：备份源代码 (给自己留后路)
:: ---------------------------------------------------------
echo.
echo [4/4] 正在备份源代码到 GitHub (hexo 分支)...
:: 将所有变动（包括 Python 改的时间戳、新写的文章、改的配置）存入暂存区
git add .

:: 提交变动，备注里自动带上当前日期和时间
git commit -m "Site Update: %date% %time%"

:: 推送到 hexo 分支
git push origin hexo

echo.
echo =======================================================
echo  恭喜！博客更新、部署、备份全流程已完成！
echo =======================================================
echo.
pause